---
layout: post
title: "Browser Extensions: The Next Generation of Malware"
permalink: /2020/extensions-the-next-generation-of-malware/
description: "With nearly unlimited access to your browser - therefore any account you have on the web - extensions represent an increasingly valuable frontier for malware authors. Alongside little store regulation, push updates to all users, and hard-to-detect command and control options, 200k infected systems in a day is all-too-easy."
date: 2020-10-20 00:00:00
tags:
- malware
- extension
- chrome
published: false
---

On October 6th, 2020, a keen-eyed Redditor by the name of [ufo56](https://www.reddit.com/user/ufo56/) spotted unexplainable activity on their Facebook and Instagram accounts after installing a new extension called "User-Agent Switcher" on their Chrome browser. Setting up [Fiddler](https://www.telerik.com/fiddler), they immediately observed concerning traffic, took some screenshots, reported the issue to Google, and posted a [warning](https://www.reddit.com/r/cybersecurity/comments/j6gg2q/chrome_extension_with_100k_installs_makes_your/) on the cybersecurity subreddit:

**Chrome extension with 100k+ installs makes your Chrome browser like random people's Facebook/Instagram pictures.**

>After install I instantly noticed some strange activity on Facebook and Instagram. I analyzed chrome traffic with Fiddler and found out that extension connects to useragentswitch.com/socket.io/xxxxx and starts liking pictures.

Interested, I started digging into the extension to find out more. I fully expected this to be a one-evening project, and initially suspected that the massive install base had simply been [fraudulent](https://www.theregister.com/2020/05/28/chrome_web_store_fraud/) to bait users into trusting the extension. But the more I dug, the more complex and concerning the story became. Now two weeks deep in my investigation, I can now confirm that this was not an isolated incident but the evolution of an active and modern campaign, in which extensions with hundreds of thousands of users are bought by an unknown party and then infected with malware.

Unfortunately, the malware author didn't stop at 100k infections. Shortly after malicious code was added to the User-Agent Switcher extension, it seems the same unknown party purchased the long-standing Nano Adblocker and Nano Defender extensions from their maintainer, Hugo Xu. Extremely similar malicious code was added two weeks later, infecting *another 250k* users as their extension auto-updated.




Lastly, we'll discuss important takeaways for users, extension authors, security teams, and even Google itself.

## Timeline

- **January 30th, 2016** (or prior): The User-Agent Switcher extension is [released](/2020/extensions-the-next-generation-of-malware/esolutions-fb-history.png) by eSolutions Nordic. This extension accumulates ~100k active users and ~140 ratings (very positive) by mid 2020.
- **September 27th, 2017** (or prior): Hugo Xu releases uBlock Protector, which is an anti-anti-adblock extension augmenting uBlock. This is eventually renamed Nano Defender and is expanded to protect both extensions from anti-adblock countermeasures. This extension [accumulates](https://chrome-stats.com/d/ggolfgbegefeeoocgjbmkembbncoadlb) 260k users and 309 ratings (extremely positive) by mid 2020.
- **January 7th, 2018** (or prior): Hugo Xu releases Nano Adblocker, a lean fork of uBlock Origin, which [accumulates](https://chrome-stats.com/d/gabbbocakeomblphkmmnoamkioajlkfo) 182k users and 255 ratings (extremely positive) by mid 2020.
- **May 28th, 2020**: User-Agent Switcher is updated to version 2.0.0.8 - this is a minor update and contains nothing suspicious.
- **July 3rd, 2020** (or prior): eSolutions Nordic [changes](/2020/extensions-the-next-generation-of-malware/esolutions-fb-history.png) the links to "their" extension, indicating the first was [sold](/2020/extensions-the-next-generation-of-malware/esolutions-fb-sale.png). This is confirmed by the link changing on their website between [May 12](https://web.archive.org/web/20200512050157/https://www.esolutions.se/) and [August 6](https://web.archive.org/web/20200806004521/https://www.esolutions.se/), though no finer-grained data is available. The new copy of their extension is uploaded to the Chrome Web Store.
- **August 29th, 2020**: User-Agent Switcher is updated to version 2.0.0.9 - this update introduces Socket.IO as well as a basic C&C structure for forced browsing, but does not steal request headers for any sites. ~100k users are infected by this action.
- **September 7th, 2020**: User-Agent Switcher is updated to version 2.0.1.0 - this is the update analyzed in this post, which was expanded from the previous version to steal request headers for certain sites.
- Prior to **October 3rd, 2020**: One or more developers claiming to be in Turkey [begin talks](https://github.com/NanoAdblocker/NanoCore/issues/362) with Hugo Xu to acquire Nano Adblocker and Nano Defender. They identify themselves as "new developers" and remain anonymous. This is a generally unpopular move, and some (lead by gorhill) voice concerns about the acquiring party.
- **October 3rd-6th, 2020**: Users begin to publicly report that User Agent Switcher has been performing malicious actions, both in [reviews](/2020/extensions-the-next-generation-of-malware/comments-warning.png) and on [Reddit](https://www.reddit.com/r/cybersecurity/comments/j6gg2q/chrome_extension_with_100k_installs_makes_your/).
- **October 5th, 2020**: The sale of Nano Adblocker and Nano Defender completes, and Hugo Xu transfers control of the Chrome extensions.
- **October 15th, 2020**: Google removes User-Agent Switcher from the Chrome Web Store, twelve days after reports are known to begin. The new owners of Nano Adblocker and Nano Defender upload their first update - it is functionally identical to the malware in User-Agent Switcher, with some additional bells & whistles including a `report` event which appears to fire if the user has Dev Tools open. ~250k users are infected by this action, for an assumed total of roughly ~350k infections in two months. Already suspicious of the transferred power, LiCybora, uBlock-user, and gorhill quickly identify the added code is [malicious](https://github.com/NanoAdblocker/NanoCore/issues/362#issuecomment-709428210).
- **October 16th, 2020** - Google removes both Nano Adblocker and Nano Defender from the Chrome Web Store, one day after the infection.

## Google Trust & Safety

Knowing more than enough about how this malware works and reporting it to parties which host or support it, has there been any action to remove it?

**As of Thursday, October 15, 2020: Finally, yes.**

Despite reaching the top of [r/cybersecurity](https://reddit.com/r/cybersecurity), getting some very bad reviews, and having a bunch of people (including me) report this extension to Google over the past week (ufo56's [post](https://www.reddit.com/r/cybersecurity/comments/j6gg2q/chrome_extension_with_100k_installs_makes_your/) was Tuesday, October 6th), it was available for download from the Chrome Web Store until the morning of Thursday the 15th.

Any unsuspecting user that has this extension installed is still having their social media accounts manipulated, and is at risk of becoming a victim to high-impact attacks on other web services they use - as they have been for *at least* one month (since the extension was updated on September 7th 2020, and possibly people have been at risk for much longer than that based on the oldest comments).

With the increased pressure from this writeup - and hopefully positive community response - I'm sure this malware will eventually be removed from the Chrome Web Store, which will automatically purge it from users who had installed it previously as well. However, that begs the question: if ufo56 didn't make a post on Reddit about this, or their post hadn't gained any traction, and they'd simply filed their report and moved on: how long would this malware remain on the Chrome Web Store? Would their one report have generated any action at all?

