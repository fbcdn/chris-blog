---
layout: post
title: "Help for Users Impacted by Infected Extensions"
permalink: /2020/extensions-the-next-generation-of-malware/help-for-users/
description: "What to do if you were compromised by several extensions bought by the malware author that I am investigating."
date: 2020-10-20 12:00:00
tags:
- malware
- extension
- chrome
#pagination: 
#  enabled: false
---

The following Chrome extensions were purchased by a malware author from their original creators, and any users of these extensions within the impacted timeframes should be considered compromised, as extensions will be auto-updated by Chrome.

There are two important disclaimers to make clear:

- First, the guidance in this post is **only** known to be valid for these extensions *on Chrome*, and if you suspect another extension you use has been compromised, seek help from a qualified security professional.
- Second, this is a living document, and I am currently analyzing the malware that was distributed in Nano Adblocker and Nano Defender. Guidance may be updated accordingly as more information is collected.

The extensions users should be concerned about are:

#### User-Agent Switcher

- Originally released by eSolutions Nordic AB, and sold to an anonymous third party
- Users during infected period: up to ~100k
- ID: clddifkhlkcojbojppdojfeeikdkgiae
- Infected versions: `2.0.0.9`, `2.0.1.0`
- Infected timeframe: August 28th, 2020 - October 15th, 2020

#### Nano Adblocker

- Originally released by Hugo Xu, and sold to an anonymous third party
- Users during infected period: up to ~182k
- ID: gabbbocakeomblphkmmnoamkioajlkfo
- Infected version: `1.0.0.154`
- Infected timeframe: October 15th, 2020 - October 16th, 2020

#### Nano Defender

- Originally released by Hugo Xu, and sold to an anonymous third party
- Users during infected period: up to ~260k
- ID: ggolfgbegefeeoocgjbmkembbncoadlb
- Infected version: `15.0.0.206`
- Infected timeframe: October 15th, 2020 - October 16th, 2020

#### Additional Suspects

Other extensions previously owned by eSolutions Nordic are also being investigated, and have allegedly been removed from the Chrome Web Store after being infected with similar malware. Please see the [How Can I Help?](#how-can-i-help) section if you have additional information about those extensions or other extensions which may be compromised by this specific strain of malware. To learn more about how these extensions operate, go to the [What Did These Do?](#what-did-these-do) section.

## What Happened?

In brief, a malware author has started approaching developers of popular Chrome Web Store extensions, which have:

- Permission to read and modify all data on all sites (ex. adblockers, development tools).
- A long malware-free existence (years).
- High ratings (generally, >4.0).
- Hundreds of thousands of active installations.

They approach these developers as an anonymous party - generally as a student or a developer just starting out - and ask to purchase rights to the extension. Sometimes those are full rights, and the malware author assumes full control of the extension (promising to maintain it), other times they negotiate a deal where they only buy the rights to the existing extension and userbase, and allow the original author to upload a new copy of their extension.

Once control of the extensions is handed over to the developers, they load a whatever the current version of their malicious payload is, and all users who have these extensions are infected as Chrome automatically updates them - rolling out malware to hundreds of thousands of users. Given the similarities between both of these infections

## What Did These Do?

I'll provide a brief technical overview of the malware's operation, but if you want to skip this section, the key takeaways are that this extension can:

- Steal your header information for certain sites (including session tokens, which are used to authenticate you). It doesn't do this by default for all sites, and has only been observed by me personally to do this for Instagram, but this *can* be done for any site the malware author chooses at any time. So, this is quite the danger.
- Force your browser to go to specific websites (generally, to like or follow specific content using your account), and report that information to the malware author. This can also be dangerous if sensitive data was accessed (ex. browsing to your messages on Facebook), but the malware author hasn't been observed doing so.

Ok, that's the TL;DR - you can move to the [How Can I Protect Myself?](#how-can-i-protect-myself) section. Now for the nerds: this payload is very lean but has been maturing quickly - within two months has expanded to steal request data as well as implement basic evasion techniques - and is unique because it uses modern web technologies (WebSockets) and high-level libraries (Socket.IO) for efficient, low-footprint command-and-control.

After the update is complete, a background tasks starts, and quickly establishes a WebSocket to a server run by the malware author (the command-and-control server), which sends events down to your browser. Those events are used by this extension to control your browser, and does two core things:

- First, the author can send a `fetch` event (this is called different things in different extensions, such as `createFetch` or `getNewList`) - this event forces your browser to browse to a specific location, such as `https://instagram.com`, and sends the response body back to the command-and-control server. So if it browsed to this page, the malware author read what you are reading right now.
- Second, the author can send a `header` event (again, called different things - such as `handlerData` or `getNewListData`) containing a domain name, this instructs the extension to intercept requests to that domain name and also send those to the command-and-control server. For example, if the malware author sends `header` event with `www.instagram.com`, all requests that either you or the extension make to `https://www.instagram.com` will also have the request information sent to the malware author. This is very dangerous because it will usually contain the session token you use for a given website, granting the malware author access to that session and allowing them to browse as if they had logged in as you.

The quickest route to compromise your account on nearly every site you use is simple. Say the malware author wanted access to your PayPal - first, they would send a `header` event to tell their extension to steal the request headers for any request going to `www.paypal.com`. Then, they would send a `fetch` event instructing the extension to fire a request to `https://www.paypal.com/dashboard/` on your behalf. This would generate two messages sent to the server:

- One containing the request headers, including your session token (which keeps you logged in to PayPal). 
- Another containing the response body, including the dashboard information for your account, potentially including your current PayPal balance.

And that's it - they have almost-complete access to any account you are logged in to via session theft. In addition, use of request interception could steal user password from requests, but *only* if the user was performing a manual login, and the author had already sent a `header` event for that site. So, this is considered possible, but unlikely.

For deeper technical reading, a technical analysis on User-Agent Switcher is in progress [here](https://github.com/partridge-tech/chris-blog/blob/master/_content/2020/extensions-the-next-generation-of-malware/user-agent-switcher.md) including traffic logs, source code dissection, and more. For people who want to investigate on their own, I have also archived the malicious extensions [here](https://github.com/partridge-tech/chris-blog/tree/master/_content/2020/extensions-the-next-generation-of-malware/no-publish) alongside the prior (nonmalicious) versions for easy `diff`s. Nano Adblocker and Nano Defender have a couple extra bells and whistles which I am analyzing now, but appear to only be detection evasion and weak obfuscation attempts. This page will be updated as more information is confirmed.

## How Can I Protect Myself?

Unfortunately, there's little that you could have done to protect yourself from these extensions outside of "not having them installed." Using a password manager or 2FA protects you from unauthorized logins (ex. a Russian hacker without your Yubikey can't create a *new* session), but neither protects you from an existing session being stolen. First, focus on the sites that are known to be impacted:

- If you were logged in to **Instagram**, you should change your password [here](https://www.instagram.com/accounts/password/reset/), which will [also](https://instazood.com/blog/how-to-logout-of-all-devices-on-instagram/) log you out of all sessions. To safe, log out and log back in afterwards to clear the session you are currently using.
- If you were logged in to **Facebook**, you should change your password first using [this help](https://www.facebook.com/help/248976822124608), then log yourself out of all sessions using [this help](https://www.facebook.com/help/211990645501187), then log out and log back in to close the session you are currently using.
- There have also been concerns raised about this extension abusing **Twitch** and **GitHub** accounts, though I am still collecting evidence, and as of right now these should be considered "unconfirmed."

You might be wondering: didn't you say that all sites could have their session tokens stolen? *Yes.* We don't know *for sure* if other sites were impacted, since this behavior was 100% controlled by the command-and-control server. To our benefit, the malware author seems to be focused on their social media like business, probably because money coming in from that is plentiful (100 likes for $1 as the going rate for Instagram, I've observed ~20 likes/hour/browser, you do the math!) and needs to be minimally laundered compared to stolen funds or proceeds from ransomware.

But for risk-averse users, you could take action to ensure your critical accounts are protected (ex. other social media, banks, investment accounts), as well as any you need for business or gainful employment (ex. webmail, corporate logins, file sharing or backup sites) by performing similar actions: terminate your session, change your password, and ideally enable 2FA to be sure you are safe.

## How Can I Help?

I have a very comprehensive view of User-Agent Switcher because there was a lot of time between it being discovered as malicious. However, I am still assessing what the scope of operations for malware in Nano Adblocker and Nano Defender.

If you have credible information that you can share about the malware author, or about what the malware did with access to your browser, please [email me](mailto:tweedge-public@partridge.tech). How do you determine if information is credible?

- Look for suspicious *actions* that were taken using your accounts. Account login attempts are suspicious, but you would have had to perform the login yourself while infected with this malware in order to divulge your password or 2FA codes (in the request headers). If you know you didn't log in during the time frame you may have been infected, those login attempts are currently understood to be not related to this event.
- Look for logs and other history information - if you use a transparent proxy (ex. Squid) or your traffic is intercepted for security, I would be interested in any domains or requests you can find which are suspicious. When reporting this, please include as much information as possible, without divulging personal or sensitive information, history, or requests.
- Look for other malware on the Chrome Web Store using WebSockets as command-and-control. There are other identifying factors for this group (Turkish affiliation, `-zzz` 'obfuscating' strings, use of Namecheap and Cloudflare for fronting infrastructure, strong control flow similarities), but that is the most-readily-detectable factor (as the Socket.IO client needs to be added to infected extensions, and is quite large even when minified) even if it's not the highest signal.

Outside of that, *please stop harassing both developers*. eSolutions Nordic AB and Hugo Xu have expressed (privately and publicly) that they deeply regret these transactions, and that they never meant to sell their users into this infection. Both parties take pride in their work, which has now been violated by someone who would take advantage of them and the community they've built for nefarious purposes.

The responsibility for ensuring that extensions distributed through the Chrome Web Store are not going to harm Chrome users should lie principally on Google's shoulders. It's important to note that users were following best practices when using these extensions - installing highly-rated extensions from developers that they could trust. Users shouldn't have to compile and manually install specific versions of the extensions they use in order to know they are going to be kept safe, or check weekly to make sure the extension is still run by the original developer. In light of these major malware attacks, as well as rampant [fraud](https://www.theregister.com/2020/05/28/chrome_web_store_fraud/) on the Chrome Web Store, users should be demanding more security assurances from the "most secure browser in the world" ([source](https://www.google.com/chrome/security/)).